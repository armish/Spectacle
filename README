*****************************************
Spectacle: Spectral learning for Annotating Chromatin Labels and Epigenomics
Copyright (C) 2013-2014 Jimin Song

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*****************************************

Spectacle is written in Java and based on the ChromHMM code. It has been tested on Linux and Windows. It extends "LearnModel", one of the top level commands of ChromHMM (http://compbio.mit.edu/ChromHMM) by adding a spectral learning algorithm for Hidden Markov Model parameter estimation.
Other than "LearnModel", all other commands are run as described in the ChromHMM manual (http://compbio.mit.edu/ChromHMM/ChromHMM_manual.pdf).

E.g. java -jar Spectacle.jar MakeSegmentation model.txt SAMPLEDATA_HG19 OUTPUTSAMPLE_HG19


**OPTIONS**

For "LearnModel", if the option "-chromhmm" is shown, Spectacle is run exactly the same as ChromHMM as described in the ChromHMM manual. Otherwise, it is run using the spectral learning algorithm with the following options:

-lambda lambdavalue : The Lambda parameter in the data smoothing step is set as lambdavalue. lambdavalue=0.95 is the default.

-spectralrandom : The emission matrix is estimated as described in Appendix C in Hsu et al 2012. Without this option, the emission matrix is estimated using anchor observations as described in the paper (Song and Chen, 2014)

-noindep : Do not use assumption that all histone marks are independent.

-p maxprocessors : A model is trained using multiple processors in parallel.

-r nmaxiterations : Number of EM iterations. nmaxiterations=1 is a default, in which parameters are not changed but the likelihood is just computed.


**EXAMPLES**
Here is an example of how to run Spectacle.jar with ChIP-seq data from ENCODE.

- Install Java 1.5 or later if not already installed.

- Download Spectacle.zip via "Download Zip" on the right side of the web page and unzip the file.

- Download ChIP-seq data from ENCODE and put it in the folder SAMPLEDATA_HG19. 
http://www.broadinstitute.org/~anshul/projects/encode/rawdata/mapped/jan2011/noMultiMapTagAlign/

hg19_cellmarkfiletable.txt contains the names of the files that were downloaded.

- Binarize Bed files. 
java -jar Spectacle.jar BinarizeBed CHROMSIZES/hg19.txt SAMPLEDATA_HG19 hg19_cellmarkfiletable.txt SAMPLEDATA_HG19

hg19_inputfilelist.txt contains the filenames of the binarized data. 

- Spectral Learning
whole genome
java -mx1200M -jar Spectacle.jar LearnModel -nobrowser -noenrich -f "hg19_inputfilelist.txt" -i spectral -lambda 1 -noindep -p 4 SAMPLEDATA_HG19 OUTPUTSAMPLE_HG19 20 hg19

one chromosome
java -mx1200M -jar Spectacle.jar LearnModel -nobrowser -noenrich -f "hg19_inputfilelist1.txt" -i spectral_chr18 -lambda 1 -noindep -p 4 SAMPLEDATA_HG19 OUTPUTSAMPLE_HG19 20 hg19


**References**
Ernst J, Kellis M. ChromHMM: automating chromatin state discovery and characterization. Nature Methods, 9:215-216, 2012.
Hoffman M, Ernst J, Wilder S, Kundaje A, Harris R, Libbrecht M, Giardine B, Ellenbogen P, Bilmes J, Birney E, Hardison R, Dunham I, Kellis M, Noble W. Integrative annotation of chromatin elements from ENCODE data. Nucleic Acids Research, 41(2):827-841, 2013.
Hsu D, Kakade SM, Zhang T. A spectral algorithm for learning hidden Markov models. Journal of Computer and System Sciences, 78:1460-1480, 2012.
Song, J and Chen, K. C. Spectacle: Faster and more accurate chromatin state annotation using spectral learning, bioRxiv doi: 10.1101/002725, 2014.
